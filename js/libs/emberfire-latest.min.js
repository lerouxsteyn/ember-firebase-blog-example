"use strict";!function(){void 0!==window.DS&&(DS.FirebaseAdapter=DS.Adapter.extend(Ember.Evented,{init:function(){if(!this.firebase||"object"!=typeof this.firebase)throw new Error("Please set the `firebase` property on the adapter.");this._ref=this.firebase.ref()},generateIdForRecord:function(){return this._ref.push().name()},find:function(a,b,c){var d=!1,e=this._getRef(b,c);return new Ember.RSVP.Promise(function(c,f){e.on("value",function(e){var f=e.val();f&&(f.id=e.name()),d?a.push(b,f):(d=!0,Ember.run(null,c,f))},function(a){d||Ember.run(null,f,a)})},"DS: FirebaseAdapter#find "+b+" to "+e.toString())},findAll:function(a,b){function c(c){if(d){var e=c.val();e.id=c.name(),a.push(b,e)}}var d=!1,e=this._getRef(b);return new Ember.RSVP.Promise(function(f,g){function h(a){d||(d=!0,Ember.run(null,g,a))}e.on("child_added",c,h),e.on("child_changed",c,h),e.on("child_removed",function(c){if(d){var e=a.getById(b,c.name());null!==e&&a.deleteRecord(e)}},h),e.once("value",function(a){var b=[];a.forEach(function(a){var c=a.val();c.id=a.name(),b.push(c)}),d=!0,Ember.run(null,f,b)})},"DS: FirebaseAdapter#findAll "+b+" to "+e.toString())},createRecord:function(a,b,c){var d=c.serialize({includeId:!1}),e=this._getRef(b,c.id);return new Ember.RSVP.Promise(function(a,b){e.set(d,function(c){c?Ember.run(null,b,c):Ember.run(null,a)})},"DS: FirebaseAdapter#createRecord "+b+" to "+e.toString())},updateRecord:function(a,b,c){return this.createRecord(a,b,c)},deleteRecord:function(a,b,c){var d=this._getRef(b,c.id);return new Ember.RSVP.Promise(function(a,b){d.remove(function(c){c?Ember.run(null,b,c):Ember.run(null,a)})},"DS: FirebaseAdapter#deleteRecord "+b+" to "+d.toString())},pathForType:function(a){var b=Ember.String.camelize(a);return Ember.String.pluralize(b)},_getRef:function(a,b){var c=this._ref;return a&&(c=c.child(this.pathForType(a.typeKey))),b&&(c=c.child(b)),c}}))}();var EmberFire=Ember.Namespace.create();EmberFire._checkType=function(a,b,c){var d=a.val(),e=d._type;switch(e){case"object":b.call(c,EmberFire.Object.create({ref:a.ref()}));break;case"array":b.call(c,EmberFire.Array.create({ref:a.ref()}));break;default:b.call(c,d)}},EmberFire.Object=Ember.ObjectProxy.extend({init:function(){function a(a){var c=a.name();EmberFire._checkType(a,function(a){Ember.set(b,c,a)},this)}var b={};this.set("content",b),this.ref.child("_type").set("object"),this.ref.on("child_added",a,this),this.ref.on("child_changed",a,this),this.ref.on("child_removed",function(a){this.set(a.name(),null)},this),this._super()},willDestroy:function(){this.ref.off()},toJSON:function(){var a={},b=this.get("content");for(var c in b)a[c]=Ember.get(b,c);return a._type="object",a},setUnknownProperty:function(a,b){return b instanceof EmberFire.Object||b instanceof EmberFire.Array?(b.ref=this.ref.child(a),void b.ref.set(b.toJSON())):(this.ref.child(a).set(b),this._super(a,b))},ref:null}),EmberFire.Array=Ember.ArrayProxy.extend({init:function(){var a=Ember.A([]);this._index=Ember.A([]),this.set("content",a),this.ref.child("_type").set("array"),this.ref.on("child_added",function(b){"_type"!=b.name()&&EmberFire._checkType(b,function(c){this._index.pushObject(b.name()),a.pushObject(c)},this)},this),this.ref.on("child_removed",function(b){if("_type"!=b.name()){var c=this._index.indexOf(b.name());this._index.removeAt(c),a.removeAt(c)}},this),this.ref.on("child_changed",function(b){if("_type"!=b.name()){var c=this._index.indexOf(b.name());a.replace(c,1,[b.val()])}},this),this._super()},replaceContent:function(a,b,c){for(var d=0;b>d;d++){var e=this._index[a+d];this.ref.child(e).remove()}c.forEach(function(a){var b=a;return a.toJSON&&(b=a.toJSON()),this.ref.push(b).name()},this)},toJSON:function(){for(var a={},b=this.get("content"),c=0;c<this._index.length;c++)a[this._index[c]]=b[c];return a._type="array",a}});